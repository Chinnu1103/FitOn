{% load static %}

<title>{{login_user.name}} Account</title>

<body>
    <!-- header part -->
    {% include "user/navbar.html" %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="{% static 'user/css/account.css' %}">

    <script>
        function loadDefaultImage(default_img) {
            document.getElementById("profile_pic").src = default_img;
        }
    </script>

    {% if messages %}
    {% for message in messages %}
    <div class="alert {{ message.tags }} alert-dismissible shadow fade show" role="alert">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
        {{ message | safe }}
    </div>
    {% endfor %}
    {% endif %}

    <!-- Left container part -->
    <div class="row container-fluid">
        <div class="Account-left container col">
            <!-- Area to upload user image (avatar) -->
            <div class="avatar-card">
                <div class="avatar-upload-area">
                    <form method="POST" action="{% url 'user:account' %}" enctype="multipart/form-data" onsubmit="return checkFileSize()">
                        {% csrf_token %}
                        {% if login_user.avatar %}
                        <img id="profile_pic" src="{{login_user.avatar.url}}" alt=""
                            onerror="loadDefaultImage('{% static 'user/images/default-avatar.png' %}')">
                        {% else %}
                        <img src="{% static 'user/images/default-avatar.png' %}" alt="Background Image">
                        {% endif %}
                        <!-- Upload button or input element -->
                        <label for="avatar-upload-input" class="avatar-upload-area-1">
                            <!-- Icon or text indicating upload action -->
                            <div class="upload-text">Upload Image</div>
                        </label>
                        <input type="file" name="avatar" id="avatar-upload-input" class="hidden-input" accept="image/*">
                    </form>
                </div>
            </div>

            <!-- name display part -->
            <div class="name-display container">
                <span>{{login_user.name}}</span>
            </div>

            <!-- user info -->
            <form id="user-info-form" method="POST" action="{% url 'user:account' %}">
                {% csrf_token %}
                <div class="user-info">
                    <div class="column">
                        <div class="row">
                            <div class="info-row">
                                <label class="info-label">Email</label>
                                <input type="text" name="email" class="info-field-disable" disabled
                                    value="{{ login_user.email }}">
                            </div>

                            <div class="info-row">
                                <label class="info-label">Name</label>
                                <input type="text" name="name" class="info-field" disabled
                                    value="{{ login_user.name }}">
                            </div>

                            <div class="info-row">
                                <label class="info-label">Phone</label>
                                <input type="text" name="phone" class="info-field" disabled
                                    value="{{ login_user.phone }}" oninput="formatPhoneNumber(this)">
                                <span id="phoneError" class="error-message"></span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="info-row">
                                <label class="info-label">Zip</label>
                                <input type="text" name="zip" class="info-field" disabled value="{{ login_user.zip }}">
                            </div>

                            <div class="info-row">
                                <label class="info-label">Gender</label>
                                <select class="info-field" id="sexSelect" name="sex" disabled>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>

                            <div class="info-row">
                                <label class="info-label">Borough</label>
                                <select class="info-field" id="boroughSelect" name="borough" disabled>
                                    <option value="BKN">Brooklyn</option>
                                    <option value="MHT">Manhattan</option>
                                    <option value="QNS">Queens</option>
                                    <option value="BRX">Bronx</option>
                                    <option value="SND">Staten Island</option>
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="info-row-2">
                                <label class="info-label">Address</label>
                                <input type="text" name="address" class="info-field" disabled
                                    value="{{ login_user.address }}">
                            </div>
                            {% if userType == "patient" %}
                            <div class="info-row-2">
                                <label class="info-label">Insurance Provider</label>
                                <input type="text" name="insurance" class="info-field" disabled
                                    value="{{ login_user.insurance_provider }}">
                            </div>
                            {% elif userType == "doctor" %}
                            <div class="info-row-2">
                                <label class="info-label">Medical Specialization</label>
                                <input type="text" name="specialization" class="info-field" disabled
                                    value="{{ login_user.primary_speciality }}">
                            </div>
                            {% endif %}
                            {% if userType != "patient" %}
                            <div class="info-row-2">
                                <label class="info-label">
                                    {% if login_user.active_status == False %}Requested {% else %}Associated {% endif %}
                                    Hospital
                                </label>
                                <input type="text" id="associatedHospital" name="associatedHospital" class="info-field"
                                    disabled value="{{ login_user.associated_hospital.name }}">
                                <input type="hidden" id="selectedId" name="hospital"
                                    value="{{ login_user.associated_hospital.id }}">
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>


                <!-- edit button -->
                <div class="buttons">
                    <button class="edit-btn">Edit</button>
                    <button type="submit" class="save-btn" id="saveButton" disabled>Save</button>
                </div>
            </form>

            <a href="{% url 'user:authorize_google_fit' %}">Sign In using Google</a>
        </div>
</body>

<!-- some js code for user interaction -->
<script>
    // Borough selection part
    var userBorough = "{{ login_user.borough }}";
    var selectElement = document.getElementById("boroughSelect");

    var userSex = "{{ login_user.sex }}";
    var sexElement = document.getElementById("sexSelect");

    // Loop through options and set the default option based on user.borough
    for (var i = 0; i < selectElement.options.length; i++) {
        if (selectElement.options[i].value === userBorough) {
            selectElement.options[i].selected = true;
            break;
        }
    }

    // Loop through options and set the default option based on user.sex
    for (var i = 0; i < sexElement.options.length; i++) {
        if (sexElement.options[i].value === userSex) {
            sexElement.options[i].selected = true;
            break;
        }
    }
</script>
<script src="{% static 'user/javascript/account.js' %}"></script>